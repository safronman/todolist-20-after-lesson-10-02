#!/usr/bin/env sh

MSG_FILE="$1"
FIRST_LINE="$(head -n 1 "$MSG_FILE")"

# Allow merge/revert commits generated by Git.
case "$FIRST_LINE" in
  Merge\ *|Revert\ *)
    exit 0
    ;;
esac

# Conventional Commits:
# <type>[optional scope][!]: <description>
PATTERN='^[a-z]+(\([a-zA-Z0-9._/-]+\))?(!)?: .+'

if printf '%s' "$FIRST_LINE" | grep -Eq "$PATTERN"; then
  exit 0
fi

echo "Invalid commit message format."
echo "Expected: <type>[optional scope][!]: <description>"
echo "Example: feat(auth): add remember-me token refresh"
echo "Allowed examples:"
echo "  fix: handle empty API response"
echo "  docs(agents): describe commit workflow"
echo "  refactor(store)!: simplify state shape"
exit 1
